<group name="authentication">
  <rule id="100001" level="10">
    <decoded_as>syslog</decoded_as>
    <match>
      <field name="tag">auth</field>
      <field name="message">.*failed.*</field>
    </match>
    <frequency>10</frequency>
    <timeframe>600</timeframe>
    <active-response>
      <command>/var/ossec/active-response/bin/block-ip.sh <command>
      <parameters>%{ip}</parameters>
    </active-response>
  </rule>

    <rule id="100002" level="10">
    <decoded_as>syslog</decoded_as>
    <field name="tag">sudo</field>
    <match>(?:\S+\s+)?command not allowed | incorrect password attempts </match>
    <frequency>10</frequency>
    <timeframe>600</timeframe>
    <options>no_full_log</options>
    <alert_by_email>yes</alert_by_email>
    <active-response>
      <command>/path/to/block_user.sh</command>
      <parameters>{1}</parameters>
    </active-response>
  </rule>
  
  <rule id="100003" level="7">
    <decoded_as>syslog</decoded_as>
    <field name="tag">sudo</field>
    <field name="program">sudo</field>
    <alert_by_email>yes</alert_by_email>
    <match>reboot|passwd</match>
  </rule>
  
</group>

<group name="system">
  
  <rule id="100001" level="15">
   <decoded_as>syslog</decoded_as>
   <alert_by_email>yes</alert_by_email>
   <match>usb-storage|sd</match>
     <active-response>
      <command>/path/to/block_usb.sh</command>
      <parameters>%{device_name}</parameters>
      <active-response>
  </rule>
  
   <rule id="100002" level="20">
    <decoded_as>syslog</decoded_as>
    <alert_by_email>yes</alert_by_email>
    <match>kernel.*(panic|Oops).*|(panic|Oops).*kernel</match>
    <active-response>
      <command>reboot</command>
    </active-response>
   </rule
     
  <rule id="100003" level="18">
    <decoded_as>syslog</decoded_as>
    <alert_by_email>yes</alert_by_email>
    <match>
       memory failure| I/O error|segmentation fault|memory access violation
    </match>
   </rule>

  <rule id="100004" level="8"> 
    <decoded_as>syslog</decoded_as>
    <match>module (inserted|removed)(?:\s*[:\s]*(\S+)?)?</match>
    <options>no_full_log</option
    <active-response>
      <command>/var/ossec/active-response/bin/check_module.sh <command>
      <parameters>{2}</parameters>
    </active-response>
  </rule>
</group>

  <group name="system">

  <rule id="10001" level="7">
    <field name="tag">ufw</field>
    <decoded_as>syslog</decoded_as>
    <match>Port Opened|allowing</match>  
    <match>22|3389|3306|1433|21|23</match>
    <alert_by_email>yes</alert_by_email>
     <active-response>
      <command>/var/ossec/active-response/bin/block-port.sh</command>
      <parameters>%{port}</parameters>
    </active-response>
  </rule>

  <rule id="10012" level="8">
   <decoded_as>syslog</decoded_as> 
   <field name="tag">ufw</field>
   <field name="src_ip">SRC=.*</field>
   <field name="dst_ip">DST=.*</field>
   <active-response>
     <command>/path/to/check_ip.sh</command>
     <parameter>$src_ip</parameter>
     <parameter>$dst_ip</parameter>
   </active-response>
  </rule>


  

